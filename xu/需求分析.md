### **需求分析：使用 Electron + Python 开发个性化小说编写应用**

#### **1. 项目概述**

该项目旨在创建一个跨平台的桌面应用，为小说作者提供强大的 AI 辅助创作功能。应用采用“融合架构”，由用户界面（Electron + Node.js）在后台静默管理一个独立的 AI 服务（Python），以实现关注点分离、开发便捷和用户体验流畅的统一。

#### **2. 主要功能模块**

*   **2.1 人物生成器**
*   **2.2 故事梗概生成器**
*   **2.3 章节规划器**
*   **2.4 剧情扩写器**
*   **2.5 知识库管理 (RAG)**
*   **2.6 输出与存储**

(注：各模块功能与前版定义一致，核心是实现从构思、规划到扩写的完整流程。)

---

#### **3. 技术架构：融合方案 (Fusion Architecture)**

本应用采用主应用“托管”后台服务的模式，将前端交互与后端 AI 计算彻底分离。

##### **3.1 AI 服务端 (Python)**

*   **定位**：一个纯粹的、无界面的“AI能力中心”服务器。
*   **开发语言**：Python。
*   **核心职责**：
    *   **提供 Web 服务**：使用 FastAPI / Flask 框架，通过本地 REST API (如 `http://localhost:PORT`) 暴露所有 AI 功能。
    *   **执行完整 RAG 流程**：负责知识库的**文件读取、向量化、索引和检索**。
    *   **封装模型调用**：统一处理对本地 Hugging Face 模型和云端 LLM API 的所有请求。
    *   **利用 Python 生态**：最大化利用 `LangChain`、`PyTorch` 等库，并支持 GPU 加速。
*   **打包**：使用 PyInstaller 等工具打包成一个单一的可执行文件 (如 `ai_server.exe`)，随主应用一同分发。

##### **3.2 应用端 (Electron + Node.js)**

*   **定位**：用户直接交互的桌面应用，是应用的“大脑”和“脸面”。
*   **开发语言**：Node.js / JavaScript (或 TypeScript)。
*   **核心职责**：
    *   **UI 渲染与交互**：使用 React 或 Vue 构建所有用户界面。
    *   **业务流程控制**：实现“分层上下文生成”等面向作者的写作流程逻辑。
    *   **AI 服务生命周期管理**：在后台静默地启动、监控和关闭 Python AI 服务进程。
    *   **发送高级指令**：通过本地 API 调用 AI 服务，只传递高级任务指令（如“扩写第三章”），不参与任何底层 AI 计算。

---

#### **4. 用户体验与部署**

*   **无感体验**：对用户而言，这是一个单一、完整的桌面应用。AI 服务的启动、关闭和通信过程对用户完全透明。
*   **简化安装**：用户只需下载并安装一个应用安装包。所有必要的依赖（包括打包好的 Python 服务）都已内置。

---

#### **5. 技术路线总结**

*   **整体架构**：**融合架构** (Electron 应用托管后台 Python AI 服务)。
*   **应用端 (主)**：Electron + Node.js + (React / Vue)。
*   **AI 服务端 (辅)**：Python + FastAPI / Flask + PyInstaller。
*   **通信方式**：本地 REST API (HTTP)。
*   **核心 AI 技术**：RAG, 分层上下文管理, Hugging Face (本地), 云端 LLM API。
*   **平台支持**：Windows, macOS, Linux。


